(this.webpackJsonpreactface=this.webpackJsonpreactface||[]).push([[0],{27:function(e,t,n){},28:function(e,t,n){},36:function(e,t){},37:function(e,t){},38:function(e,t){},40:function(e,t,n){},42:function(e,t,n){"use strict";n.r(t);var c=n(2),a=n.n(c),r=n(17),i=n.n(r),o=(n(27),n.p,n(28),n(14)),s=n(7),d=n(9),u=n.n(d),l=n(6),f=(n(40),n(3));var h=function(){var e=Object(c.useRef)(null),t=Object(c.useState)(0),n=Object(s.a)(t,2),a=n[0],r=n[1],i=Object(c.useRef)(null),d=Object(c.useRef)(null),h=Object(c.useRef)(null),j=Object(c.useRef)(null),v=[];Object(c.useEffect)(Object(o.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.e("/models");case 2:return e.next=4,l.d("/models");case 4:case"end":return e.stop()}}),e)}))),[]);var b=function(e){var t=(v=[e].concat(v).slice(0,30)).reduce((function(e,t){return e+t}))/v.length,n=d.current,c=h.current;n.value=Math.round(t)+" ms",c.value=l.h.round(1e3/t)+" fps"},x=function(e){return e.map((function(e){return[e.x,e.y]})).reduce((function(e,t){return[e[0]+t[0],e[1]+t[1]]})).map((function(t){return t/e.length}))},p=function(){var t=e.current,n=setInterval(Object(o.a)(u.a.mark((function e(){var n,c,a,r,o,s,d,f,h,v,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Date.now(),!0,.5,2,e.next=6,l.b(t,new l.a({minConfidence:.5,maxResults:2})).withFaceLandmarks(true);case 6:c=e.sent,b(Date.now()-n),c&&(a=i.current,(r=a.getContext("2d")).clearRect(0,0,a.width,a.height),r.translate(a.width,0),r.scale(-1,1),r.setTransform(-1,0,0,1,a.width,0),o=l.f(a,t,!0),s=l.g(c,o),d=x(s.landmarks.getRightEye()),f=x(s.landmarks.getLeftEye()),h=x(s.landmarks.getNose()),x(s.landmarks.getMouth()),u=s.landmarks.getJawOutline(),u.map((function(e){return e.y})).reduce((function(e,t){return Math.min(e,t)})),v=(f[0]+(d[0]-f[0])/2-h[0])/s.detection._box._width,p=v.toFixed(2),j.current.value=p<-.06?"user is facing left side, face angle = "+v.toFixed(2):p>=.07?"user is facing right side, face angle = "+v.toFixed(2):"user is facing straight, face angle = "+v.toFixed(2),l.c.drawDetections(a,s),l.c.drawFaceLandmarks(a,s));case 9:case"end":return e.stop()}var u}),e)}))),500);r(n)};return Object(f.jsxs)("div",{children:[Object(f.jsx)("button",{onClick:function(){var t=window.constraints={audio:!1,video:{width:480,height:480}};navigator.mediaDevices.getUserMedia(t).then((function(t){var n=e.current;n.srcObject=t,n.play(),p()})).catch((function(e){console.error("error:",e)}))}.bind(this),children:"Start"}),Object(f.jsx)("button",{onClick:function(){e.current.srcObject.getTracks().forEach((function(e){e.stop()})),clearInterval(a);var t=i.current;t.getContext("2d").clearRect(0,0,t.width,t.height)}.bind(this),children:"Stop"}),Object(f.jsxs)("div",{id:"playground",children:[Object(f.jsx)("video",{ref:e,autoPlay:!0,id:"videoplay"}),Object(f.jsx)("canvas",{ref:i,id:"overlay"})]}),Object(f.jsxs)("div",{id:"fps_meter",children:[Object(f.jsxs)("div",{children:[Object(f.jsx)("label",{children:"Time:"}),Object(f.jsx)("input",{disabled:!0,ref:d,value:"-",id:"time",type:"text"}),Object(f.jsx)("label",{children:"Estimated Fps:"}),Object(f.jsx)("input",{disabled:!0,ref:h,value:"-",id:"fps",type:"text"})]}),Object(f.jsxs)("div",{children:[Object(f.jsx)("label",{children:"Estimated Face Pose: "}),Object(f.jsx)("textarea",{disabled:!0,ref:j,value:"-"})]})]})]})},j=n(18),v=n(19),b=n(22),x=n(20),p=function(e){Object(b.a)(n,e);var t=Object(x.a)(n);function n(e){var c;return Object(j.a)(this,n),(c=t.call(this,e)).btnRef=a.a.createRef(),c.videoRef=a.a.createRef(),c.canvasRef=a.a.createRef(),c.fpsRef=a.a.createRef(),c}return Object(v.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=document.createElement("script");t.src="/opencv.js",t.async=!0,t.onload=function(){return e.onOpenCvReady()},document.body.appendChild(t)}},{key:"componentWillUnmount",value:function(){for(var e=document.getElementsByTagName("script"),t=e.length;t>=0;t--)e[t]&&null!==e[t].getAttribute("src")&&-1!==e[t].getAttribute("src").indexOf("".concat("/opencv.js"))&&e[t].parentNode.removeChild(e[t])}},{key:"createFileFromUrl",value:function(e,t,n){var c=new XMLHttpRequest;c.open("GET",t,!0),c.responseType="arraybuffer",c.onload=function(a){if(4===c.readyState)if(200===c.status){var r=new Uint8Array(c.response);window.cv.FS_createDataFile("/",e,r,!0,!1,!1),n()}else console.log("Failed to load "+t+" status: "+c.status)},c.send()}},{key:"onOpenCvReady",value:function(){var e=this,t=window.cv;t.onRuntimeInitialized=function(){console.log("OpenCV.js is ready!",t),e.createFileFromUrl("face.xml","models/haarcascade_frontalface_default.xml",(function(){console.log("OK")}));var n=e.videoRef.current,c=(new t.Mat(n.height,n.width,t.CV_8UC4),new t.Mat(n.height,n.width,t.CV_8UC4)),a=new t.Mat,r=new t.VideoCapture(n),i=new t.RectVector,o=(new t.RectVector,new t.CascadeClassifier),s=new t.CascadeClassifier,d=!1,u=document.getElementById("fps"),l=document.getElementById("face-pose"),f=1e3/30;function h(){try{if(!d)return;var e=Date.now();r.read(c),t.cvtColor(c,a,t.COLOR_RGBA2GRAY,0),o.detectMultiScale(a,i,1.2,3,0,new t.Size(70));for(var n=-1,s=0,j=0;j<i.size();++j){var v=i.get(j),b=v.width*v.height;b>s&&(s=b,n=j)}if(-1!=n){var x=i.get(n),p=new t.Point(x.x,x.y),g=new t.Point(x.x+x.width,x.y+x.height);t.rectangle(c,p,g,[0,255,0,255],2);x.x,x.y,x.width,Math.round(x.height/2);l.innerText="Straight, face angle not calculated "}else l.innerText="not detected";t.imshow("canvasOutput",c);var O=Date.now()-e,m=f-O;u.innerText=(1e3/Math.max(f,O)).toFixed(2).toString(),setTimeout(h,m)}catch(w){console.log(w)}}var j=e.btnRef.current;j.onclick=function(){(d=!d)?(navigator.mediaDevices.getUserMedia({video:{width:480,height:480,facingMode:"user"},audio:!1}).then((function(e){n.srcObject=e,n.play()})).catch((function(e){console.log("An error occurred! "+e)})),o.load("/face.xml"),s.load("/eye.xml"),h(),j.innerText="Stop"):j.innerText="Start"}}}},{key:"render",value:function(){return Object(f.jsx)("div",{children:Object(f.jsx)("div",{children:Object(f.jsx)("div",{children:Object(f.jsxs)("div",{children:[Object(f.jsx)("button",{id:"start-or-stop",ref:this.btnRef,children:"Start"}),Object(f.jsx)("video",{id:"input-video",width:"480",height:"480",hidden:!0,ref:this.videoRef}),Object(f.jsx)("canvas",{id:"canvasOutput",width:"480",height:"480",ref:this.canvasRef}),Object(f.jsxs)("p",{children:["FPS: ",Object(f.jsx)("span",{id:"fps",children:"0"})]}),Object(f.jsxs)("p",{children:["Face pose: ",Object(f.jsx)("span",{id:"face-pose",children:"no face"})]})]})})})})}}]),n}(a.a.Component),g=n(21),O=n(4);var m=function(){return Object(f.jsx)(g.a,{children:Object(f.jsxs)(O.c,{children:[Object(f.jsx)(O.a,{path:"/",element:Object(f.jsx)(h,{})}),Object(f.jsx)(O.a,{path:"/haar",element:Object(f.jsx)(p,{})})]})})},w=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,43)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),r(e),i(e)}))};i.a.render(Object(f.jsx)(a.a.StrictMode,{children:Object(f.jsx)(m,{})}),document.getElementById("root")),w()}},[[42,1,2]]]);
//# sourceMappingURL=main.9e4d7dce.chunk.js.map